<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptForge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* New background image */
            background-image: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAEABQADASIAAhEBAxEB/8QAGwABAAMBAQEBAAAAAAAAAAAAAAECBAMFBgf/xAA5EAACAgECAwYFAwQCAgMAAAAAAQIDEQQhBRIxQRMVIlFhcYGRoTJCUrHB0eEGM0OC8PEkU2Jy/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEh/9oADAMBAAIRAxEAPwD2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAlAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQCUAAAAAAAAAAAAAAAAAAAB//2Q==');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        /* Simple, clean theme */
        .app-panel {
            background-color: #1f2937; /* gray-800 */
            border: 1px solid #374151; /* gray-700 */
        }
        
        .chat-bubble-user {
            background-color: #2563eb; /* blue-600 */
            color: #ffffff;
        }
        .chat-bubble-ai {
            background-color: #4b5563; /* gray-600 */
            color: #f3f4f6; /* gray-100 */
        }
        .chat-bubble-system {
            text-align: center;
            width: 100%;
            font-size: 0.875rem; /* text-sm */
            color: #9ca3af; /* gray-400 */
        }


        /* Custom scrollbar */
        *::-webkit-scrollbar { width: 8px; }
        *::-webkit-scrollbar-track { background: #1f2937; /* gray-800 */ }
        *::-webkit-scrollbar-thumb { background-color: #4b5563; /* gray-600 */ border-radius: 4px; }
        *::-webkit-scrollbar-thumb:hover { background-color: #6b7280; /* gray-500 */ }
        
        /* Astro Bot Avatar Styles */
        #avatar-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 50;
            width: 120px;
            height: 120px;
            pointer-events: none;
        }
        #astro-head {
            transition: transform 0.2s ease-out;
        }

        /* Catchy gradient text for heading */
        .gradient-text {
            background-image: linear-gradient(to right, #60a5fa, #c084fc); /* blue-400 to purple-400 */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

    </style>
</head>
<body class="text-gray-200 flex flex-col h-full antialiased">
    <div id="app-container" class="flex-grow flex flex-col max-w-7xl w-full mx-auto p-4 md:p-6 h-full">
        <!-- Header -->
        <header class="mb-4 text-center relative">
            <h1 class="text-4xl md:text-5xl font-bold gradient-text">PromptForge</h1>
            <p class="text-sm text-gray-400 mt-1">Your Personal Interface for Creative AI</p>
            <button id="clear-history-btn" class="absolute top-0 right-0 mt-2 mr-2 text-xs bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500">Clear Memory</button>
        </header>
        
        <!-- Tool Panels Container -->
        <main class="flex-grow flex flex-col min-h-0">
            <!-- Chat/Prompt Panel -->
            <div id="panel-chat" class="tool-panel app-panel rounded-lg p-4 flex flex-col flex-grow">
                 <main id="chat-container" class="flex-grow overflow-y-auto space-y-6 p-4 rounded-lg bg-gray-900/90">
                    <!-- Chat history will be loaded here -->
                 </main>

                <footer class="mt-4 relative z-20">
                    <form id="chat-form" class="flex items-center gap-2 md:gap-4">
                        <input type="file" id="file-input" class="hidden" accept=".txt,.md,text/plain,image/*">
                        <button type="button" id="import-file-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold p-3 rounded-lg transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                        <input type="text" id="user-input" placeholder="Ask RIKA a question, or import a file..." class="flex-grow bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-white" required>
                        <button type="submit" id="send-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-5 rounded-lg transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </form>
                </footer>
            </div>
        </main>
    </div>
    
    <!-- Astro Bot Avatar -->
    <div id="avatar-container">
        <!-- SVG content will be injected here by JavaScript -->
    </div>


    <script>
        // ---
        // --- IMPORTANT: PASTE YOUR GOOGLE API KEY HERE ---
        // --- You can get a free key from Google AI Studio: https://aistudio.google.com/
        // ---
        const apiKey = ""; // <--- PASTE YOUR KEY INSIDE THE QUOTES

        // --- RIKA's new astro bot avatar ---
        const astroBotSVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g id="astro-body"><rect x="25" y="50" width="50" height="35" rx="10" fill="#4b5563"/><rect x="45" y="45" width="10" height="5" fill="#374151"/></g><g id="astro-head" style="transform-origin: 50px 35px;"><rect x="30" y="10" width="40" height="40" rx="15" fill="#f3f4f6"/><line x1="50" y1="10" x2="50" y2="0" stroke="#9ca3af" stroke-width="2"/><circle cx="50" cy="-2" r="3" fill="#2563eb"/><circle cx="42" cy="30" r="4" fill="#111827"/><circle cx="58" cy="30" r="4" fill="#111827"/></g></svg>`;
        const astroBotDataURL = "data:image/svg+xml," + encodeURIComponent(astroBotSVG);


        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const chatContainer = document.getElementById('chat-container');
            const sendButton = document.getElementById('send-button');
            const importFileBtn = document.getElementById('import-file-btn');
            const fileInput = document.getElementById('file-input');
            const avatarContainer = document.getElementById('avatar-container');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            
            // --- State ---
            let chatHistory = [];
            let importedFile = null;

            // --- Initial Setup ---
            loadChatHistory();
            setupAvatar();
            
            // --- Event Listeners ---
            clearHistoryBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the chat memory?')) {
                    localStorage.removeItem('chatHistory');
                    location.reload();
                }
            });

            function setupAvatar() {
                if(avatarContainer) {
                    avatarContainer.innerHTML = astroBotSVG;
                    const astroHead = document.getElementById('astro-head');
                    document.addEventListener('mousemove', (e) => {
                        if (!astroHead) return;
                        const { clientX, clientY } = e;
                        const { innerWidth, innerHeight } = window;
                        const rotY = -1 * (((clientX / innerWidth) * 20) - 10);
                        const rotX = (((clientY / innerHeight) * 20) - 10);
                        astroHead.style.transform = `perspective(500px) rotateX(${rotX}deg) rotateY(${rotY}deg)`;
                    });
                }
            }
            
            function saveChatHistory() {
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            }

            function loadChatHistory() {
                const savedHistory = localStorage.getItem('chatHistory');
                if (savedHistory && JSON.parse(savedHistory).length > 0) {
                    chatHistory = JSON.parse(savedHistory);
                    chatContainer.innerHTML = '';
                    chatHistory.forEach(turn => {
                        const sender = turn.role === 'user' ? 'user' : 'ai';
                        let contentHtml = '';
                        turn.parts.forEach(part => {
                            if (part.text) {
                                contentHtml += `<p>${part.text.replace(/\n/g, '<br>').replace(/\*\*/g, '')}</p>`;
                            } else if (part.inlineData) {
                                contentHtml += `<img src="data:${part.inlineData.mimeType};base64,${part.inlineData.data}" alt="uploaded image" class="max-w-xs rounded-lg">`;
                            }
                        });
                        addMessageToChat(sender, contentHtml);
                    });
                } else {
                    const initialMessage = "Hello, I am RIKA. How can I help you today?";
                    chatHistory.push({ role: 'model', parts: [{ text: initialMessage }] });
                    addMessageToChat('ai', initialMessage);
                }
            }

            importFileBtn.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    importedFile = {
                        name: file.name,
                        type: file.type,
                        data: event.target.result
                    };
                    
                    if (file.type.startsWith('image/')) {
                        const userMessage = `<img src="${importedFile.data}" alt="${importedFile.name}" class="max-w-xs rounded-lg">`;
                        addMessageToChat('user', userMessage);
                        handleTextResponse("Describe this image in deep detail.");
                    } else {
                        addMessageToChat('system', `File "${file.name}" imported. Ask a question about it.`);
                    }
                };

                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file);
                }
                fileInput.value = '';
            });
            
            chatForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const userMessage = userInput.value.trim();
                if (userMessage) {
                    addMessageToChat('user', userMessage);
                    handleTextResponse(userMessage);
                    userInput.value = '';
                }
            });

            function addMessageToChat(sender, message) {
                const messageWrapper = document.createElement('div');
                
                if (sender === 'user') {
                    messageWrapper.className = 'flex items-start gap-3 justify-end';
                    messageWrapper.innerHTML = `<div class="chat-bubble-user p-3 rounded-lg max-w-xl">${message}</div><div class="h-8 w-8 bg-gray-400 text-gray-800 rounded-full flex-shrink-0 flex items-center justify-center font-bold">You</div>`;
                } else if (sender === 'ai') {
                    messageWrapper.className = 'flex items-start gap-3';
                    messageWrapper.innerHTML = `<img src="${astroBotDataURL}" class="h-8 w-8 rounded-full flex-shrink-0 object-cover bg-white p-1"><div class="chat-bubble-ai p-3 rounded-lg max-w-xl">${message}</div>`;
                } else if (sender === 'system') {
                    messageWrapper.className = 'chat-bubble-system p-2';
                    messageWrapper.innerHTML = `<p>${message}</p>`;
                }
                
                chatContainer.appendChild(messageWrapper);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            async function handleTextResponse(userMessage) {
                if (!apiKey) {
                    addMessageToChat('ai', "API key not found. Please add your Google API key to the script file to continue.");
                    return;
                }
                sendButton.disabled = true;
                const tempAIMessage = addMessageToChat('ai', '...');
                
                const userParts = [];
                if (userMessage) {
                    userParts.push({ text: userMessage });
                }

                if (importedFile) {
                    if (importedFile.type.startsWith('image/')) {
                        userParts.push({
                            inlineData: {
                                mimeType: importedFile.type,
                                data: importedFile.data.split(',')[1]
                            }
                        });
                    } else { // Text file
                        userParts.unshift({ text: `CONTEXT: Here is the content of the file "${importedFile.name}":\n\n${importedFile.data}\n\nUSER QUESTION: `});
                    }
                    importedFile = null; // Consume the file
                }
                
                chatHistory.push({ role: 'user', parts: userParts });

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const payload = { contents: chatHistory };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (!response.ok) {
                        throw new Error(result.error?.message || `API Error: ${response.status}`);
                    }
                    const aiText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't get a response.";
                    
                    chatContainer.lastChild.querySelector('.chat-bubble-ai').innerHTML = `<p>${aiText.replace(/\n/g, '<br>').replace(/\*\*/g, '')}</p>`;

                    chatHistory.push({ role: 'model', parts: [{ text: aiText }] });
                    saveChatHistory();

                } catch (error) {
                    console.error("Text API Error:", error);
                    chatContainer.lastChild.querySelector('.chat-bubble-ai').textContent = `Error: API call failed. ${error.message}. Please check your API key.`;
                    // Remove the failed user message from history to prevent future errors
                    chatHistory.pop();
                } finally {
                    sendButton.disabled = false;
                }
            }
        });
    </script>
</body>
</html>

